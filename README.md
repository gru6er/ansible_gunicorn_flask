# ansible_gunicorn_flask

Сформировать ansible роль для запуска python приложения на удаленном сервере.

В качестве удаленного сервера при тестировании использовать docker образ или lxd контейнер. Инициализацию и запуск тестовой машины для docker или lxd оформить в bash скрипт. ОС тестовой машины - ubuntu 18.04. Вместе с ОС должен быть установлен openssh-server для доступа по ssh (по паролю или ключам - не имеет значения).

Таким образом, процесс тестирования развертывания приложения должен выглядеть следующим образом:

1. Запустить bash скрипт инициализации и запуска тестовой машины (должен позволять многократный запуск, т.е. инициализация должна быть либо опцией командной строки, либо должно быть реализовано детектирование уже проведённой инициализации, например, по
имени образа);

2. Установка требуемых зависимостей для ansible роли (либо через bash скрипт, либо через встроенную систему установки зависимостей ansible);

3. Запуск роли с заранее подготовленным inventory файлом, в котором описано ssh подключение к тестовой машине;

4. Переход на http://<ip docker> должен отобразить python приложение

Требования к развертываемому окружению (эти задачи должен решать ansible):

1. Добавить непривилегированного пользователя, приложение запускать только под ним.
2. Вручную скомпилировать интерпретатор python версии 3.6.13.
3. Сформировать виртуальное окружение virtualenv в папке непривилегированного пользователя.
4. Установить веб-сервер gunicorn в виртуальное окружение.
5. Установить приложение через клонирование git репозитория и локальной установки в виртуальное окружение.
6. Запустить несколько worker-ов gunicorn для python приложения от интерпретатора виртуального окружения, обеспечить их запуск при старте системы, а также автоматическую перезагрузку при сбое (имеется в виду супервизор процесса)*.
7. Если приложение требует запуска процессов/демонов кроме веб-сервера - реализовать их запуск при старте системы и гипервизию (аналогично предыдущему пункту).
8. Файлы конфигурации для веб-сервера и запускаемых процессов/демонов должны формироваться ролью ansible.
9. Файлы логов приложения, gunicorn и nginx должны быть выделены в отдельную папку (возможно подпапки в папке).
10. Установить и сконфигурировать nginx, настроить доступ к приложению по корневой ссылке default_server (т.е. чтобы приложение отображалось просто при заходе по ip)

